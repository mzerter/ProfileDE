function dfdxval = chemo_dfdx(times, y, logp)

p = exp(logp);

[nt, ny] = size(y);

p3  = p(3);
p4  = p(4);
p5  = p(5);
p6  = p(6);
p7  = p(7);
p8  = p(8);
p9  = p(9);
p10 = p(10);
p11 = p(11);
p12 = p(12);
p13 = p(13);
p14 = p(14);
p15 = p(15);
p16 = p(16);

y1 = y(:,1);
y2 = y(:,2);
y3 = y(:,3);
y4 = y(:,4);
y5 = y(:,5);

p10py1  = p10 + y1;
p11py1  = p11 + y1;
y4py5   = y4 + y5;

E10 = exp( 100*p3*y2 - 100*p16   + 100*p4*y3);
E11 = exp( 200*p3*y2 - 200*p16   + 200*p4*y3);
E15 = exp( 100*p16   - 100*p3*y2 - 100*p4*y3);

E10p1 = E10 + 1;
E11p1 = E11 + 1;
E15p1 = E15 + 1;

dfdxval = zeros(nt,ny,ny);

dfdxval(:,1,1) = (p12*y1*y2)/p10py1^2 - (p12*y2)/p10py1 - ...
                 (p12*y3)/p11py1 - p6 + (p12*y1*y3)/p11py1^2;
dfdxval(:,1,2) = (p10.*p12.*p9.*y2)./p10py1.^2;
dfdxval(:,1,3) = (p11.*p12.*p9.*y3)./p11py1.^2;

dfdxval(:,2,1) = -(p12.*y1)./p10py1;
dfdxval(:,2,2) = (p12*p9*y1)/p10py1 - p6 - ...
                 (p13*p3*y4py5)/(p15 + p16/E10p1 + ...
                 (E10*(p3*y2 + p4*y3))/E10p1) + ...
                 (p13*p3*y2*y4py5*((p3*E10)/E10p1 - ...
                 (100*p16*p3*E10)/E10p1^2 + ...
                 (100*p3*E10*(p3*y2 + p4*y3))/E10p1 - ...
                 (100*p3*E11*(p3*y2 + p4*y3))/E10p1^2))/(p15 + p16/E10p1 + ...
                 (E10*(p3*y2 + p4*y3))/E10p1)^2;
dfdxval(:,2,3) = (p13*p4*y3*y4py5*((p3*E10)/E10p1 + ...
                 (100*p3*E10*(p3*y2 + p4*y3))/E10p1 - ...
                 (100*p3*E11*(p3*y2 + p4*y3))/E10p1^2) - ...
                 (100*p13*p16*p3*p4*y3*E10*y4py5)/E10p1^2)/(p15 + p16/E10p1 + ...
                 (E10*(p3*y2 + p4*y3))/E10p1)^2;
dfdxval(:,2,4) = (E10* ...
                   (2*p13*p14*p15*p3*y4 - p13*p14*p3*y4* ...
                      (100*p3^2*y2^2 + 200*p3*p4*y2*y3 + 100*p4^2*y3^2) + ...
                      p13*p14*p16*p3*y4*(100*p3*y2 + 100*p4*y3 + 1)) + ...
                    p13*p14*p16*p3*y4 + p13*p14*p15*p3*y4*E11p1)/ ...
                  (p15 + p16 + p15*E10 + p3*y2*E10 + p4*y3*E10)^2;
dfdxval(:,3,1) = -(p12.*y1)./p11py1;
dfdxval(:,3,2) = (p13*p3*y2*y4py5*((p4*E10)/E10p1 + ...
                 (100*p4*E10*(p3*y2 + p4*y3))/E10p1 - ...
                 (100*p4*E11*(p3*y2 + p4*y3))/E10p1^2) - ...
                 (100*p13*p16*p3*p4*y2*E10*y4py5)/E10p1^2)/(p15 + p16/E10p1 + ...
                 (E10*(p3*y2 + p4*y3))/E10p1)^2;
dfdxval(:,3,3) = (p12*p9*y1)/p11py1 - p6 - ...
                 (p13*p4*y4py5)/(p15 + p16/E10p1 + ...
                 (E10*(p3*y2 + p4*y3))/E10p1) + ...
                 (p13*p4*y3*y4py5*((p4*E10)/E10p1 - (100*p16*p4*E10)/E10p1^2 + ...
                 (100*p4*E10*(p3*y2 + p4*y3))/E10p1 - ...
                 (100*p4*E11*(p3*y2 + p4*y3))/E10p1^2))/(p15 + p16/E10p1 + ...
                 (E10*(p3*y2 + p4*y3))/E10p1)^2;
dfdxval(:,3,4) = (E10*(2*p13*p14*p15*p4*y4 - ...
                 p13*p14*p4*y4*(100*p3^2*y2^2 + ...
                 200*p3*p4*y2*y3 + 100*p4^2*y3^2) + ...
                 p13*p14*p16*p4*y4*(100*p3*y2 + 100*p4*y3 + 1)) + ...
                 p13*p14*p16*p4*y4 + ...
                 p13*p14*p15*p4*y4*E11p1)/ ...
                 (p15 + p16 + p15*E10 + p3*y2*E10 + p4*y3*E10)^2;

dfdxval(:,4,2) = -(p13*p3*y2*E15p1)/(p15 + p3*y2 + p4*y3 + p15*E15 + p16*E15);
dfdxval(:,4,3) = -(p13*p4*y3*E15p1)/(p15 + p3*y2 + p4*y3 + p15*E15 + p16*E15); 
dfdxval(:,4,4) = -(p15*p6 + p16*p6 + p15*p7 + p16*p7 + p15*p8 + ...
                   p16*p8 - p13*p14*p3*y2 - ...
                   p13*p14*p4*y3)/(p15 + p16) - ...
                   (p15*p6 + p15*p7 + p15*p8 - ...
                   ((p15 + p3*y2 + p4*y3)*(p15*p6 + p16*p6 + p15*p7 + ...
                   p16*p7 + p15*p8 + p16*p8 - p13*p14*p3*y2 - ...
                   p13*p14*p4*y3))/(p15 + p16) + p3*p6*y2 + p3*p7*y2 + ...
                   p3*p8*y2 + p4*p6*y3 + p4*p7*y3 + p4*p8*y3 - ...
                   p13*p14*p3*y2 - p13*p14*p4*y3)/ ...
                   (p15 + p3*y2 + p4*y3 + p15*E15 + p16*E15);
dfdxval(:,4,5) = p8;

dfdxval(:,5,2) = -(p13*p3*y2*E15p1)/(p15 + p3*y2 + p4*y3 + p15*E15 + p16*E15);
dfdxval(:,5,3) = -(p13*p4*y3*E15p1)/(p15 + p3*y2 + p4*y3 + p15*E15 + p16*E15);
dfdxval(:,5,5) = - p6 - p7;

% for i=1:nt
%     for j=1:ny
%         dfdxval(i,j,:) = dfdxval(i,j,:)/y(i,j);
%         dfdxval(i,j,j) = dfdxval(i,j,j) - fnval(i,j)/y(i,j)^2;
%     end
% end

end

